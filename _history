{"entries":[{"timestamp":1764250812012,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":133,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":33,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":203,"length1":39,"diffs":[[1,"        \"README.md\"\n"]]},{"start1":230,"length1":35,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]},{"type":"added","filename":"wifi.ts","value":"\n//% color=#009b5b icon=\"\\uf1eb\" block=\"ESP8266 Techno\"\nnamespace ESP8266Techno {\n\n\n    let isWifiConnected = false;\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi\n     */\n    //% block=\"Setup Wifi|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifi(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixed)\n     */\n    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd|IP %adresseip|IP %adresseip | Passerelle %gateway | Masque %netmask|\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifiandIP(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string, adresseip: string, gateway: string, netmask: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        sendAtCmd(`AT+CIPSTA=\"${adresseip}\",\"${gateway}\",\"${netmask}\"`)\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n\n\n    /**\n     * Check if Grove - Uart WiFi V2 is connected to Wifi\n     */\n    //% block=\"Wifi OK?\"\n    //% group=\"UartWiFi\"\n    export function wifiOK() {\n        return isWifiConnected\n    }\n\n    /**\n     * Send data to ThinkSpeak\n     */\n    //% block=\"Send Data to your ThinkSpeak Channel|Write API Key %apiKey|Field1 %field1|Field2 %field2|Field3 %field3|Field4 %field4|Field5 %field5|Field6 %field6|Field7 %field7|Field8 %field8\"\n    //% group=\"UartWiFi\"\n    //% apiKey.defl=\"your Write API Key\"\n    export function sendToThinkSpeak(apiKey: string, field1: number, field2: number, field3: number, field4: number, field5: number, field6: number, field7: number, field8: number) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"api.thingspeak.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /update?api_key=\" + apiKey\n            if (!isNaN(field1)) data = data + \"&field1=\" + field1\n            if (!isNaN(field2)) data = data + \"&field2=\" + field2\n            if (!isNaN(field3)) data = data + \"&field3=\" + field3\n            if (!isNaN(field4)) data = data + \"&field4=\" + field4\n            if (!isNaN(field5)) data = data + \"&field5=\" + field5\n            if (!isNaN(field6)) data = data + \"&field6=\" + field6\n            if (!isNaN(field7)) data = data + \"&field7=\" + field7\n            if (!isNaN(field8)) data = data + \"&field8=\" + field8\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n    /**\n     * Send data to IFTTT\n     */\n    //% block=\"Send Data to your IFTTT Event|Event %event|Key %key|value1 %value1|value2 %value2|value3 %value3\"\n    //% group=\"UartWiFi\"\n    //% event.defl=\"your Event\"\n    //% key.defl=\"your Key\"\n    //% value1.defl=\"hello\"\n    //% value2.defl=\"micro\"\n    //% value3.defl=\"bit\"\n    function sendToIFTTT(event: string, key: string, value1: string, value2: string, value3: string) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"maker.ifttt.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /trigger/\" + event + \"/with/key/\" + key\n            data = data + \"?value1=\" + value1\n            data = data + \"&value2=\" + value2\n            data = data + \"&value3=\" + value3\n            data = data + \" HTTP/1.1\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"User-Agent: curl/7.58.0\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Host: maker.ifttt.com\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Accept: */*\"\n            data = data + \"\\u000D\\u000A\"\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        let buffer = \"\"\n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n\n\n    /**\n    * Envoyer une commande AT\n    */\n    //% block=\"Envoyer Commande |Command AT = %cmd\"\n    //% SC=\"SC\"\n\n\n    export function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n}"}]},{"timestamp":1764251153063,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":2186,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"device_forever\" x=\"0\" y=\"0\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":265,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":249,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":693,"length1":131,"diffs":[[1,""]]},{"start1":1159,"length1":177,"diffs":[[1,"    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd|IP %adresseip|IP %adresseip | Passerelle %gateway | Masque %netmask|\"\n"]]},{"start1":1470,"length1":436,"diffs":[[1,"    export function setupWifiandIP(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string, adresseip: string, gateway: string, netmask: string) {\n"]]},{"start1":2103,"length1":145,"diffs":[[1,"        sendAtCmd(`AT+CIPSTA=\"${adresseip}\",\"${gateway}\",\"${netmask}\"`)\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n"]]}]}]},{"timestamp":1764258997676,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1254,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"-319\" y=\"1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"ESP8266Techno_setupWifi\"><field name=\"txPin\">SerialPin.P14</field><field name=\"rxPin\">SerialPin.P0</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">5000</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"ESP8266Techno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"0\" y=\"0\"></block><block type=\"ESP8266Techno_setupWifiandIP\" disabled-reasons=\"pxt_automatic_disabled\" x=\"255\" y=\"179\"><field name=\"txPin\">SerialPin.P14</field><field name=\"rxPin\">SerialPin.P0</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\" disabled-reasons=\"pxt_automatic_disabled\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\" disabled-reasons=\"pxt_automatic_disabled\"><field name=\"TEXT\">lehavre123</field></shadow></value><value name=\"adresseip\"><shadow type=\"text\" disabled-reasons=\"pxt_automatic_disabled\"><field name=\"TEXT\">10.72.70.2</field></shadow></value><value name=\"gateway\"><shadow type=\"text\" disabled-reasons=\"pxt_automatic_disabled\"><field name=\"TEXT\">10.72.70.228</field></shadow></value><value name=\"masquesr\"><shadow type=\"text\" disabled-reasons=\"pxt_automatic_disabled\"><field name=\"TEXT\">255.255.255.0</field></shadow></value></block></xml>"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":782,"length1":51,"diffs":[[1,"        basic.showString(result)\n        \n"]]},{"start1":909,"length1":50,"diffs":[[1,""]]},{"start1":943,"length1":113,"diffs":[[1,"        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n"]]},{"start1":1128,"length1":50,"diffs":[[1,""]]},{"start1":7538,"length1":38,"diffs":[[1,"    export function sendAtCmd(cmd: string) {\n"]]}]}]},{"timestamp":1764266484834,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1659,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"ESP8266Techno_setupWifi\"><field name=\"txPin\">SerialPin.P14</field><field name=\"rxPin\">SerialPin.P0</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">5000</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"ESP8266Techno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"325\" y=\"20\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":77,"diffs":[[1,""]]},{"start1":57,"length1":29,"diffs":[[1,"SerialPin.P14,\nSerialPin.P0,\n"]]},{"start1":136,"length1":0,"diffs":[[1,"basic.pause(5000)\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":113,"length1":83,"diffs":[[1,"        \"microphone\": \"*\"\n"]]},{"start1":249,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":83,"length1":20,"diffs":[[1,"\n"]]},{"start1":693,"length1":377,"diffs":[[1,""]]},{"start1":721,"length1":142,"diffs":[[1,"        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(convertToText(result))\n"]]},{"start1":833,"length1":0,"diffs":[[1,"        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(convertToText(result))\n\n"]]},{"start1":1065,"length1":77,"diffs":[[1,"        //basic.showString(convertToText(result))\n"]]},{"start1":1116,"length1":66,"diffs":[[1,"        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n"]]},{"start1":1239,"length1":93,"diffs":[[1,"        //basic.showString(convertToText(result))\n"]]},{"start1":1290,"length1":55,"diffs":[[1,""]]},{"start1":7199,"length1":9,"diffs":[[1,"        let buffer = \"\"\n"]]}]}]},{"timestamp":1764364213180,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":306,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1764364223654,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":844,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"device_forever\" x=\"229\" y=\"-105\"></block><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"grove_lcd_init\"><next><block type=\"grove_lcd_dispaly_on\"><next><block type=\"grove_lcd_show_string\"><value name=\"n\"><shadow type=\"text\"><field name=\"TEXT\">Hello</field></shadow></value><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"15\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"ESP8266Techno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"ESP8266Techno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":109,"length1":0,"diffs":[[1,"ESP8266Techno.setupWifi(\nSerialPin.P15,\nSerialPin.P1,\nBaudRate.BaudRate115200,\n\"s7toto\",\n\"lehavre123\"\n)\nif (ESP8266Techno.wifiOK()) {\n    basic.showIcon(IconNames.Happy)\n} else {\n    basic.showIcon(IconNames.Sad)\n}\n"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":56,"length1":23,"diffs":[[1,"namespace ESP8266Techno {\n"]]},{"start1":712,"length1":43,"diffs":[[1,""]]},{"start1":738,"length1":115,"diffs":[[1,"        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"AT \" + convertToText(result))\n        pause(1000)\n"]]},{"start1":906,"length1":20,"diffs":[[1,"        sendAtCmd(\"AT+RESTORE\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n        \n        sendAtCmd(\"AT+RST\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"M \" + convertToText(result))\n        pause(1000)\n\n"]]},{"start1":1571,"length1":44,"diffs":[[1,""]]},{"start1":1666,"length1":0,"diffs":[[1,"        basic.showString(buffer)\n        pause(1000)\n\n"]]}]}]},{"timestamp":1764364811875,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1636,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"grove_lcd_init\"><next><block type=\"grove_lcd_dispaly_on\"><next><block type=\"grove_lcd_show_string\"><value name=\"n\"><shadow type=\"text\"><field name=\"TEXT\">Hello</field></shadow></value><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"15\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"719\" y=\"-17\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":109,"length1":193,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":306,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":778,"length1":0,"diffs":[[1,"\n"]]},{"start1":798,"length1":50,"diffs":[[1,""]]},{"start1":893,"length1":51,"diffs":[[1,""]]},{"start1":911,"length1":0,"diffs":[[1,"        \n"]]}]}]},{"timestamp":1764365401934,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1652,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"device_forever\" x=\"586\" y=\"0\"></block><block type=\"pxt-on-start\" x=\"53\" y=\"79\"><statement name=\"HANDLER\"><block type=\"grove_lcd_init\"><next><block type=\"grove_lcd_dispaly_on\"><next><block type=\"grove_lcd_show_string\"><value name=\"n\"><shadow type=\"text\"><field name=\"TEXT\">Hello</field></shadow></value><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"15\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"WifiTechno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"WifiTechno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":185,"length1":23,"diffs":[[1,"\"\",\n\"\"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":281,"length1":46,"diffs":[[1,"        \"wifi.ts\"\n"]]},{"start1":306,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]},{"type":"added","filename":"tempsinternet.ts","value":"/*******************************************************************************\n * Functions for Simple Network Time Protocol.\n *\n * Company: Cytron Technologies Sdn Bhd\n * Website: http://www.cytron.io\n * Email:   support@cytron.io\n *******************************************************************************/\n\n// NTP server.\nconst NTP_SERVER_URL = \"pool.ntp.org\"\n\nnamespace WifiTechno {\n    // Flag to indicate whether the SNTP time is initialized.\n    let internetTimeInitialized = false\n\n    // Flag to indicate whether the SNTP time is updated successfully.\n    let internetTimeUpdated = false\n\n    // Time and date.\n    let year = 0, month = 0, day = 0, weekday = 0, hour = 0, minute = 0, second = 0\n\n\n\n    /**\n     * Return the year.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=30\n    //% blockGap=8\n    //% blockId=esp8266_get_year\n    //% block=\"year\"\n    export function getYear(): number {\n        return year\n    }\n\n    /**\n     * Return the month.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=29\n    //% blockGap=8\n    //% blockId=esp8266_get_month\n    //% block=\"month\"\n    export function getMonth(): number {\n        return month\n    }\n\n    /**\n     * Return the day.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=28\n    //% blockGap=8\n    //% blockId=esp8266_get_day\n    //% block=\"day\"\n    export function getDay(): number {\n        return day\n    }\n\n    /**\n     * Return the day of week.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=27\n    //% blockGap=8\n    //% blockId=esp8266_get_weekday\n    //% block=\"day of week\"\n    export function getWeekday(): number {\n        return weekday\n    }\n\n    /**\n     * Return the hour.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=26\n    //% blockGap=8\n    //% blockId=esp8266_get_hour\n    //% block=\"hour\"\n    export function getHour(): number {\n        return hour\n    }\n\n    /**\n     * Return the minute.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=25\n    //% blockGap=8\n    //% blockId=esp8266_get_minute\n    //% block=\"minute\"\n    export function getMinute(): number {\n        return minute\n    }\n\n    /**\n     * Return the second.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=24\n    //% blockGap=40\n    //% blockId=esp8266_get_second\n    //% block=\"second\"\n    export function getSecond(): number {\n        return second\n    }\n\n\n\n    /**\n     * Return true if the internet time is initialzed successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=23\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_initialized\n    //% block=\"internet time initialized\"\n    export function isInternetTimeInitialized(): boolean {\n        return internetTimeInitialized\n    }\n\n\n\n    /**\n     * Initialize the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=22\n    //% blockGap=40\n    //% blockId=esp8266_init_internet_time\n    //% block=\"initialize internet time at timezone %timezone\"\n    //% timezone.min=-11 timezone.max=13\n    export function initInternetTime(timezone: number) {\n        // Reset the flags.\n        internetTimeInitialized = false\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Enable the SNTP and set the timezone. Return if failed.\n        //if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n        if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n\n        internetTimeInitialized = true\n        return\n    }\n\n\n\n    /**\n     * Return true if the internet time is updated successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=21\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_updated\n    //% block=\"internet time updated\"\n    export function isInternetTimeUpdated(): boolean {\n        return internetTimeUpdated\n    }\n\n\n\n    /**\n     * Update the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=20\n    //% blockGap=8\n    //% blockId=esp8266_update_internet_time\n    //% block=\"update internet time\"\n    export function updateInternetTime() {\n        // Reset the flag.\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Make sure it's initialized.\n        if (internetTimeInitialized == false) return\n\n        // Wait until we get a valid time update.\n        let responseArray\n        let timestamp = input.runningTime()\n        while (true) {\n            // Timeout after 10 seconds.\n            if (input.runningTime() - timestamp > 20000) {\n                return\n            }\n\n            // Get the time.\n            sendCommand(\"AT+CIPSNTPTIME?\")\n            let response = getResponse(\"+CIPSNTPTIME:\", 2000)\n            if (response == \"\") return\n\n            // Fill up the time and date accordingly.\n            response = response.slice(response.indexOf(\":\") + 1)\n            responseArray = response.split(\" \")\n\n            // Remove the preceeding \" \" for each field.\n            while (responseArray.removeElement(\"\"));\n\n            // If the year is still 1970, means it's not updated yet.\n            if (responseArray[4] != \"1970\") {\n                break\n            }\n\n            basic.pause(100)\n        }\n\n        // Day of week.\n        switch (responseArray[0]) {\n            case \"Mon\": weekday = 1; break\n            case \"Tue\": weekday = 2; break\n            case \"Wed\": weekday = 3; break\n            case \"Thu\": weekday = 4; break\n            case \"Fri\": weekday = 5; break\n            case \"Sat\": weekday = 6; break\n            case \"Sun\": weekday = 7; break\n        }\n\n        // Month.\n        switch (responseArray[1]) {\n            case \"Jan\": month = 1; break\n            case \"Feb\": month = 2; break\n            case \"Mar\": month = 3; break\n            case \"Apr\": month = 4; break\n            case \"May\": month = 5; break\n            case \"Jun\": month = 6; break\n            case \"Jul\": month = 7; break\n            case \"Aug\": month = 8; break\n            case \"Sep\": month = 9; break\n            case \"Oct\": month = 10; break\n            case \"Nov\": month = 11; break\n            case \"Dec\": month = 12; break\n        }\n\n        // Day.\n        day = parseInt(responseArray[2])\n\n        // Time.\n        let timeArray = responseArray[3].split(\":\")\n        hour = parseInt(timeArray[0])\n        minute = parseInt(timeArray[1])\n        second = parseInt(timeArray[2])\n\n        // Year.\n        year = parseInt(responseArray[4])\n\n\n\n        // Wait until OK is received.\n        if (getResponse(\"OK\") == \"\") return\n\n\n        internetTimeUpdated = true\n        return\n    }\n}\n"}]},{"timestamp":1764365990682,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":281,"length1":18,"diffs":[[1,"        \"wifi.ts\",\n        \"tempsinternet.ts\"\n"]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":141,"length1":37,"diffs":[[1,"     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi\n"]]},{"start1":204,"length1":103,"diffs":[[1,"    //% block=\"Setup Wifi|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n"]]},{"start1":1394,"length1":65,"diffs":[[1,"     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixed)\n"]]}]},{"type":"removed","filename":"tempsinternet.ts","value":"/*******************************************************************************\n * Functions for Simple Network Time Protocol.\n *\n * Company: Cytron Technologies Sdn Bhd\n * Website: http://www.cytron.io\n * Email:   support@cytron.io\n *******************************************************************************/\n\n// NTP server.\nconst NTP_SERVER_URL = \"pool.ntp.org\"\n\nnamespace WifiTechno {\n    // Flag to indicate whether the SNTP time is initialized.\n    let internetTimeInitialized = false\n\n    // Flag to indicate whether the SNTP time is updated successfully.\n    let internetTimeUpdated = false\n\n    // Time and date.\n    let year = 0, month = 0, day = 0, weekday = 0, hour = 0, minute = 0, second = 0\n\n\n\n    /**\n     * Return the year.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=30\n    //% blockGap=8\n    //% blockId=esp8266_get_year\n    //% block=\"year\"\n    export function getYear(): number {\n        return year\n    }\n\n    /**\n     * Return the month.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=29\n    //% blockGap=8\n    //% blockId=esp8266_get_month\n    //% block=\"month\"\n    export function getMonth(): number {\n        return month\n    }\n\n    /**\n     * Return the day.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=28\n    //% blockGap=8\n    //% blockId=esp8266_get_day\n    //% block=\"day\"\n    export function getDay(): number {\n        return day\n    }\n\n    /**\n     * Return the day of week.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=27\n    //% blockGap=8\n    //% blockId=esp8266_get_weekday\n    //% block=\"day of week\"\n    export function getWeekday(): number {\n        return weekday\n    }\n\n    /**\n     * Return the hour.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=26\n    //% blockGap=8\n    //% blockId=esp8266_get_hour\n    //% block=\"hour\"\n    export function getHour(): number {\n        return hour\n    }\n\n    /**\n     * Return the minute.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=25\n    //% blockGap=8\n    //% blockId=esp8266_get_minute\n    //% block=\"minute\"\n    export function getMinute(): number {\n        return minute\n    }\n\n    /**\n     * Return the second.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=24\n    //% blockGap=40\n    //% blockId=esp8266_get_second\n    //% block=\"second\"\n    export function getSecond(): number {\n        return second\n    }\n\n\n\n    /**\n     * Return true if the internet time is initialzed successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=23\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_initialized\n    //% block=\"internet time initialized\"\n    export function isInternetTimeInitialized(): boolean {\n        return internetTimeInitialized\n    }\n\n\n\n    /**\n     * Initialize the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=22\n    //% blockGap=40\n    //% blockId=esp8266_init_internet_time\n    //% block=\"initialize internet time at timezone %timezone\"\n    //% timezone.min=-11 timezone.max=13\n    export function initInternetTime(timezone: number) {\n        // Reset the flags.\n        internetTimeInitialized = false\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Enable the SNTP and set the timezone. Return if failed.\n        //if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n        if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n\n        internetTimeInitialized = true\n        return\n    }\n\n\n\n    /**\n     * Return true if the internet time is updated successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=21\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_updated\n    //% block=\"internet time updated\"\n    export function isInternetTimeUpdated(): boolean {\n        return internetTimeUpdated\n    }\n\n\n\n    /**\n     * Update the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=20\n    //% blockGap=8\n    //% blockId=esp8266_update_internet_time\n    //% block=\"update internet time\"\n    export function updateInternetTime() {\n        // Reset the flag.\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Make sure it's initialized.\n        if (internetTimeInitialized == false) return\n\n        // Wait until we get a valid time update.\n        let responseArray\n        let timestamp = input.runningTime()\n        while (true) {\n            // Timeout after 10 seconds.\n            if (input.runningTime() - timestamp > 20000) {\n                return\n            }\n\n            // Get the time.\n            sendCommand(\"AT+CIPSNTPTIME?\")\n            let response = getResponse(\"+CIPSNTPTIME:\", 2000)\n            if (response == \"\") return\n\n            // Fill up the time and date accordingly.\n            response = response.slice(response.indexOf(\":\") + 1)\n            responseArray = response.split(\" \")\n\n            // Remove the preceeding \" \" for each field.\n            while (responseArray.removeElement(\"\"));\n\n            // If the year is still 1970, means it's not updated yet.\n            if (responseArray[4] != \"1970\") {\n                break\n            }\n\n            basic.pause(100)\n        }\n\n        // Day of week.\n        switch (responseArray[0]) {\n            case \"Mon\": weekday = 1; break\n            case \"Tue\": weekday = 2; break\n            case \"Wed\": weekday = 3; break\n            case \"Thu\": weekday = 4; break\n            case \"Fri\": weekday = 5; break\n            case \"Sat\": weekday = 6; break\n            case \"Sun\": weekday = 7; break\n        }\n\n        // Month.\n        switch (responseArray[1]) {\n            case \"Jan\": month = 1; break\n            case \"Feb\": month = 2; break\n            case \"Mar\": month = 3; break\n            case \"Apr\": month = 4; break\n            case \"May\": month = 5; break\n            case \"Jun\": month = 6; break\n            case \"Jul\": month = 7; break\n            case \"Aug\": month = 8; break\n            case \"Sep\": month = 9; break\n            case \"Oct\": month = 10; break\n            case \"Nov\": month = 11; break\n            case \"Dec\": month = 12; break\n        }\n\n        // Day.\n        day = parseInt(responseArray[2])\n\n        // Time.\n        let timeArray = responseArray[3].split(\":\")\n        hour = parseInt(timeArray[0])\n        minute = parseInt(timeArray[1])\n        second = parseInt(timeArray[2])\n\n        // Year.\n        year = parseInt(responseArray[4])\n\n\n\n        // Wait until OK is received.\n        if (getResponse(\"OK\") == \"\") return\n\n\n        internetTimeUpdated = true\n        return\n    }\n}\n"}]},{"timestamp":1764366589589,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":84,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"device_forever\" x=\"586\" y=\"0\"></block><block type=\"pxt-on-start\" x=\"53\" y=\"79\"><statement name=\"HANDLER\"><block type=\"grove_lcd_init\"><next><block type=\"grove_lcd_dispaly_on\"><next><block type=\"grove_lcd_show_string\"><value name=\"n\"><shadow type=\"text\"><field name=\"TEXT\">Hello</field></shadow></value><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"15\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"WifiTechno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"WifiTechno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":306,"length1":44,"diffs":[[1,""]]}]},{"type":"edited","filename":"wifi.ts","patch":[{"start1":1,"length1":52,"diffs":[[1,"//% color=#009b5b icon=\"\\uf1eb\" block=\"ESP8266 Techno\"\n"]]},{"start1":141,"length1":38,"diffs":[[1,"     * Uart WiFi V2 connecté au i-Fi\n"]]},{"start1":1380,"length1":47,"diffs":[[1,"     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixe)\n"]]},{"start1":1453,"length1":173,"diffs":[[1,"    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate| SSID = %ssid| Password = %passwd |Adresse IP = %adresseip |Passerelle = %gateway | Masque = %masquesr\"\n"]]}]},{"type":"added","filename":"test.ts","value":"// les tests vont ici ; cela ne sera pas compilé si ce paquet est utilisé en tant qu'extension.\n"}]}],"snapshots":[{"timestamp":1764250812011,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"wifi ip\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1764277531558,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"ESP8266Techno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"ESP8266Techno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"325\" y=\"20\"></block></xml>","main.ts":"basic.showIcon(IconNames.Heart)\nESP8266Techno.setupWifi(\nSerialPin.P15,\nSerialPin.P1,\nBaudRate.BaudRate115200,\n\"s7toto\",\n\"lehavre123\"\n)\nif (ESP8266Techno.wifiOK()) {\n    basic.showIcon(IconNames.Happy)\n} else {\n    basic.showIcon(IconNames.Sad)\n}\nbasic.forever(function () {\n\t\n})\n","README.md":"","wifi.ts":"\n//% color=#009b5b icon=\"\\uf1eb\" block=\"ESP8266 Techno\"\nnamespace ESP8266Techno {\n\n    let buffer = \"\"\n    let isWifiConnected = false;\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi\n     */\n    //% block=\"Setup Wifi|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifi(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"ATE0\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"AT \" + convertToText(result))\n        pause(1000)\n        \n        \n        \n        sendAtCmd(\"AT+RESTORE\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n        \n        sendAtCmd(\"AT+RST\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"M \" + convertToText(result))\n        pause(1000)\n\n        \n\n\n\n\n\n\n        \n\n        sendAtCmd(\"AT+CWJAP=\\\"\" + ssid + \"\\\",\\\"\" + passwd + \"\\\"\")\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n        basic.showString(\"W \" + convertToText(result))\n        \n        \n        pause(1000)\n\n\n        basic.showString(buffer)\n        pause(1000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixed)\n     */\n    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate| SSID = %ssid| Password = %passwd |Adresse IP = %adresseip |Passerelle = %gateway | Masque = %masquesr\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifiandIP(txPin: SerialPin, \n                                    rxPin: SerialPin, \n                                    baudRate: BaudRate, \n                                    ssid: string, \n                                    passwd: string, \n                                    adresseip: string, \n                                    gateway: string, \n                                    masquesr: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        sendAtCmd(`AT+CIPSTA=\"${adresseip}\",\"${gateway}\",\"${masquesr}\"`)\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        \n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n\n\n    /**\n     * Check if Grove - Uart WiFi V2 is connected to Wifi\n     */\n    //% block=\"Wifi OK?\"\n    //% group=\"UartWiFi\"\n    export function wifiOK() {\n        return isWifiConnected\n    }\n\n    /**\n     * Send data to ThinkSpeak\n     */\n    //% block=\"Send Data to your ThinkSpeak Channel|Write API Key %apiKey|Field1 %field1|Field2 %field2|Field3 %field3|Field4 %field4|Field5 %field5|Field6 %field6|Field7 %field7|Field8 %field8\"\n    //% group=\"UartWiFi\"\n    //% apiKey.defl=\"your Write API Key\"\n    export function sendToThinkSpeak(apiKey: string, field1: number, field2: number, field3: number, field4: number, field5: number, field6: number, field7: number, field8: number) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"api.thingspeak.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /update?api_key=\" + apiKey\n            if (!isNaN(field1)) data = data + \"&field1=\" + field1\n            if (!isNaN(field2)) data = data + \"&field2=\" + field2\n            if (!isNaN(field3)) data = data + \"&field3=\" + field3\n            if (!isNaN(field4)) data = data + \"&field4=\" + field4\n            if (!isNaN(field5)) data = data + \"&field5=\" + field5\n            if (!isNaN(field6)) data = data + \"&field6=\" + field6\n            if (!isNaN(field7)) data = data + \"&field7=\" + field7\n            if (!isNaN(field8)) data = data + \"&field8=\" + field8\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n    /**\n     * Send data to IFTTT\n     */\n    //% block=\"Send Data to your IFTTT Event|Event %event|Key %key|value1 %value1|value2 %value2|value3 %value3\"\n    //% group=\"UartWiFi\"\n    //% event.defl=\"your Event\"\n    //% key.defl=\"your Key\"\n    //% value1.defl=\"hello\"\n    //% value2.defl=\"micro\"\n    //% value3.defl=\"bit\"\n    function sendToIFTTT(event: string, key: string, value1: string, value2: string, value3: string) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"maker.ifttt.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /trigger/\" + event + \"/with/key/\" + key\n            data = data + \"?value1=\" + value1\n            data = data + \"&value2=\" + value2\n            data = data + \"&value3=\" + value3\n            data = data + \" HTTP/1.1\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"User-Agent: curl/7.58.0\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Host: maker.ifttt.com\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Accept: */*\"\n            data = data + \"\\u000D\\u000A\"\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        \n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n\n\n    /**\n    * Envoyer une commande AT\n    */\n    //% block=\"Envoyer Commande |Command AT = %cmd\"\n    //% SC=\"SC\"\n\n\n    function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n}","pxt.json":"{\n    \"name\": \"wifi ip\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"wifi.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1764364213180,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"ESP8266Techno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"ESP8266Techno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"305\" y=\"0\"></block></xml>","main.ts":"","README.md":"","wifi.ts":"\n//% color=#009b5b icon=\"\\uf1eb\" block=\"ESP8266 Techno\"\nnamespace ESP8266Techno {\n\n    let buffer = \"\"\n    let isWifiConnected = false;\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi\n     */\n    //% block=\"Setup Wifi|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifi(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"ATE0\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"AT \" + convertToText(result))\n        pause(1000)\n        \n        \n        \n        sendAtCmd(\"AT+RESTORE\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n        \n        sendAtCmd(\"AT+RST\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"RST \" + convertToText(result))\n        pause(1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        //basic.showString(\"M \" + convertToText(result))\n        pause(1000)\n\n        \n\n\n\n\n\n\n        \n\n        sendAtCmd(\"AT+CWJAP=\\\"\" + ssid + \"\\\",\\\"\" + passwd + \"\\\"\")\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n        basic.showString(\"W \" + convertToText(result))\n        \n        \n        pause(1000)\n\n\n        basic.showString(buffer)\n        pause(1000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixed)\n     */\n    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate| SSID = %ssid| Password = %passwd |Adresse IP = %adresseip |Passerelle = %gateway | Masque = %masquesr\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifiandIP(txPin: SerialPin, \n                                    rxPin: SerialPin, \n                                    baudRate: BaudRate, \n                                    ssid: string, \n                                    passwd: string, \n                                    adresseip: string, \n                                    gateway: string, \n                                    masquesr: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        sendAtCmd(`AT+CIPSTA=\"${adresseip}\",\"${gateway}\",\"${masquesr}\"`)\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        \n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n\n\n    /**\n     * Check if Grove - Uart WiFi V2 is connected to Wifi\n     */\n    //% block=\"Wifi OK?\"\n    //% group=\"UartWiFi\"\n    export function wifiOK() {\n        return isWifiConnected\n    }\n\n    /**\n     * Send data to ThinkSpeak\n     */\n    //% block=\"Send Data to your ThinkSpeak Channel|Write API Key %apiKey|Field1 %field1|Field2 %field2|Field3 %field3|Field4 %field4|Field5 %field5|Field6 %field6|Field7 %field7|Field8 %field8\"\n    //% group=\"UartWiFi\"\n    //% apiKey.defl=\"your Write API Key\"\n    export function sendToThinkSpeak(apiKey: string, field1: number, field2: number, field3: number, field4: number, field5: number, field6: number, field7: number, field8: number) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"api.thingspeak.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /update?api_key=\" + apiKey\n            if (!isNaN(field1)) data = data + \"&field1=\" + field1\n            if (!isNaN(field2)) data = data + \"&field2=\" + field2\n            if (!isNaN(field3)) data = data + \"&field3=\" + field3\n            if (!isNaN(field4)) data = data + \"&field4=\" + field4\n            if (!isNaN(field5)) data = data + \"&field5=\" + field5\n            if (!isNaN(field6)) data = data + \"&field6=\" + field6\n            if (!isNaN(field7)) data = data + \"&field7=\" + field7\n            if (!isNaN(field8)) data = data + \"&field8=\" + field8\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n    /**\n     * Send data to IFTTT\n     */\n    //% block=\"Send Data to your IFTTT Event|Event %event|Key %key|value1 %value1|value2 %value2|value3 %value3\"\n    //% group=\"UartWiFi\"\n    //% event.defl=\"your Event\"\n    //% key.defl=\"your Key\"\n    //% value1.defl=\"hello\"\n    //% value2.defl=\"micro\"\n    //% value3.defl=\"bit\"\n    function sendToIFTTT(event: string, key: string, value1: string, value2: string, value3: string) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"maker.ifttt.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /trigger/\" + event + \"/with/key/\" + key\n            data = data + \"?value1=\" + value1\n            data = data + \"&value2=\" + value2\n            data = data + \"&value3=\" + value3\n            data = data + \" HTTP/1.1\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"User-Agent: curl/7.58.0\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Host: maker.ifttt.com\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Accept: */*\"\n            data = data + \"\\u000D\\u000A\"\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        \n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n\n\n    /**\n    * Envoyer une commande AT\n    */\n    //% block=\"Envoyer Commande |Command AT = %cmd\"\n    //% SC=\"SC\"\n\n\n    function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n}","pxt.json":"{\n    \"name\": \"wifi ip\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"wifi.ts\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1764366316186,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"device_forever\" x=\"586\" y=\"0\"></block><block type=\"pxt-on-start\" x=\"53\" y=\"79\"><statement name=\"HANDLER\"><block type=\"grove_lcd_init\"><next><block type=\"grove_lcd_dispaly_on\"><next><block type=\"grove_lcd_show_string\"><value name=\"n\"><shadow type=\"text\"><field name=\"TEXT\">Hello</field></shadow></value><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"15\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"WifiTechno_setupWifi\"><field name=\"txPin\">SerialPin.P15</field><field name=\"rxPin\">SerialPin.P1</field><field name=\"baudrate\">BaudRate.BaudRate115200</field><value name=\"ssid\"><shadow type=\"text\"><field name=\"TEXT\">s7toto</field></shadow></value><value name=\"passwd\"><shadow type=\"text\"><field name=\"TEXT\">lehavre123</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"WifiTechno_wifiOK\"></block></value><statement name=\"DO0\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement><statement name=\"ELSE\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>","main.ts":"grove.lcd_init()\ngrove.lcd_dispaly_on()\ngrove.lcd_show_string(\"Hello\", 0, 0)\nbasic.showIcon(IconNames.Heart)\nWifiTechno.setupWifi(\nSerialPin.P15,\nSerialPin.P1,\nBaudRate.BaudRate115200,\n\"s7toto\",\n\"lehavre123\"\n)\nif (WifiTechno.wifiOK()) {\n    basic.showIcon(IconNames.Happy)\n} else {\n    basic.showIcon(IconNames.Sad)\n}\nbasic.forever(function () {\n\t\n})\n","README.md":"","wifi.ts":"\n//% color=#009b5b icon=\"\\uf1eb\" block=\"ESP8266 Techno\"\nnamespace WifiTechno {\n\n    let buffer = \"\"\n    let isWifiConnected = false;\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi\n     */\n    //% block=\"Setup Wifi|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifi(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        pause(100)\n        sendAtCmd(\"ATE0\")\n        pause(100)\n        grove.lcd_show_string(\"AT et ATE0\", 0, 0)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        grove.lcd_show_string(\"AT+CWMODE=1\", 0, 0)\n        \n        \n        buffer = \"\"\n        sendAtCmd(\"AT+CWJAP=\\\"\" + ssid + \"\\\",\\\"\" + passwd + \"\\\"\")\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n        grove.lcd_show_string(buffer, 0, 0)\n        basic.showString(\"W \" + convertToText(result))\n        \n        \n        pause(1000)\n\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    /**\n     * Setup Grove - Uart WiFi V2 to connect to  Wi-Fi (IP Fixed)\n     */\n    //% block=\"Setup Wifi et IP |TX %txPin|RX %rxPin|Baud rate %baudrate| SSID = %ssid| Password = %passwd |Adresse IP = %adresseip |Passerelle = %gateway | Masque = %masquesr\"\n    //% group=\"UartWiFi\"\n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200\n    export function setupWifiandIP(txPin: SerialPin, \n                                    rxPin: SerialPin, \n                                    baudRate: BaudRate, \n                                    ssid: string, \n                                    passwd: string, \n                                    adresseip: string, \n                                    gateway: string, \n                                    masquesr: string) {\n        let result = 0\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        sendAtCmd(`AT+CIPSTA=\"${adresseip}\",\"${gateway}\",\"${masquesr}\"`)\n        //result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n        \n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n\n\n    /**\n     * Check if Grove - Uart WiFi V2 is connected to Wifi\n     */\n    //% block=\"Wifi OK?\"\n    //% group=\"UartWiFi\"\n    export function wifiOK() {\n        return isWifiConnected\n    }\n\n    /**\n     * Send data to ThinkSpeak\n     */\n    //% block=\"Send Data to your ThinkSpeak Channel|Write API Key %apiKey|Field1 %field1|Field2 %field2|Field3 %field3|Field4 %field4|Field5 %field5|Field6 %field6|Field7 %field7|Field8 %field8\"\n    //% group=\"UartWiFi\"\n    //% apiKey.defl=\"your Write API Key\"\n    export function sendToThinkSpeak(apiKey: string, field1: number, field2: number, field3: number, field4: number, field5: number, field6: number, field7: number, field8: number) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"api.thingspeak.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /update?api_key=\" + apiKey\n            if (!isNaN(field1)) data = data + \"&field1=\" + field1\n            if (!isNaN(field2)) data = data + \"&field2=\" + field2\n            if (!isNaN(field3)) data = data + \"&field3=\" + field3\n            if (!isNaN(field4)) data = data + \"&field4=\" + field4\n            if (!isNaN(field5)) data = data + \"&field5=\" + field5\n            if (!isNaN(field6)) data = data + \"&field6=\" + field6\n            if (!isNaN(field7)) data = data + \"&field7=\" + field7\n            if (!isNaN(field8)) data = data + \"&field8=\" + field8\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n    /**\n     * Send data to IFTTT\n     */\n    //% block=\"Send Data to your IFTTT Event|Event %event|Key %key|value1 %value1|value2 %value2|value3 %value3\"\n    //% group=\"UartWiFi\"\n    //% event.defl=\"your Event\"\n    //% key.defl=\"your Key\"\n    //% value1.defl=\"hello\"\n    //% value2.defl=\"micro\"\n    //% value3.defl=\"bit\"\n    function sendToIFTTT(event: string, key: string, value1: string, value2: string, value3: string) {\n        let result = 0\n        let retry = 2\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"maker.ifttt.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /trigger/\" + event + \"/with/key/\" + key\n            data = data + \"?value1=\" + value1\n            data = data + \"&value2=\" + value2\n            data = data + \"&value3=\" + value3\n            data = data + \" HTTP/1.1\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"User-Agent: curl/7.58.0\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Host: maker.ifttt.com\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Accept: */*\"\n            data = data + \"\\u000D\\u000A\"\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        \n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n\n\n    /**\n    * Envoyer une commande AT\n    */\n    //% block=\"Envoyer Commande |Command AT = %cmd\"\n    //% SC=\"SC\"\n\n\n    function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n}","tempsinternet.ts":"/*******************************************************************************\n * Functions for Simple Network Time Protocol.\n *\n * Company: Cytron Technologies Sdn Bhd\n * Website: http://www.cytron.io\n * Email:   support@cytron.io\n *******************************************************************************/\n\n// NTP server.\nconst NTP_SERVER_URL = \"pool.ntp.org\"\n\nnamespace WifiTechno {\n    // Flag to indicate whether the SNTP time is initialized.\n    let internetTimeInitialized = false\n\n    // Flag to indicate whether the SNTP time is updated successfully.\n    let internetTimeUpdated = false\n\n    // Time and date.\n    let year = 0, month = 0, day = 0, weekday = 0, hour = 0, minute = 0, second = 0\n\n\n\n    /**\n     * Return the year.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=30\n    //% blockGap=8\n    //% blockId=esp8266_get_year\n    //% block=\"year\"\n    export function getYear(): number {\n        return year\n    }\n\n    /**\n     * Return the month.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=29\n    //% blockGap=8\n    //% blockId=esp8266_get_month\n    //% block=\"month\"\n    export function getMonth(): number {\n        return month\n    }\n\n    /**\n     * Return the day.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=28\n    //% blockGap=8\n    //% blockId=esp8266_get_day\n    //% block=\"day\"\n    export function getDay(): number {\n        return day\n    }\n\n    /**\n     * Return the day of week.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=27\n    //% blockGap=8\n    //% blockId=esp8266_get_weekday\n    //% block=\"day of week\"\n    export function getWeekday(): number {\n        return weekday\n    }\n\n    /**\n     * Return the hour.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=26\n    //% blockGap=8\n    //% blockId=esp8266_get_hour\n    //% block=\"hour\"\n    export function getHour(): number {\n        return hour\n    }\n\n    /**\n     * Return the minute.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=25\n    //% blockGap=8\n    //% blockId=esp8266_get_minute\n    //% block=\"minute\"\n    export function getMinute(): number {\n        return minute\n    }\n\n    /**\n     * Return the second.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=24\n    //% blockGap=40\n    //% blockId=esp8266_get_second\n    //% block=\"second\"\n    export function getSecond(): number {\n        return second\n    }\n\n\n\n    /**\n     * Return true if the internet time is initialzed successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=23\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_initialized\n    //% block=\"internet time initialized\"\n    export function isInternetTimeInitialized(): boolean {\n        return internetTimeInitialized\n    }\n\n\n\n    /**\n     * Initialize the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=22\n    //% blockGap=40\n    //% blockId=esp8266_init_internet_time\n    //% block=\"initialize internet time at timezone %timezone\"\n    //% timezone.min=-11 timezone.max=13\n    export function initInternetTime(timezone: number) {\n        // Reset the flags.\n        internetTimeInitialized = false\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Enable the SNTP and set the timezone. Return if failed.\n        //if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n        if (sendCommand(\"AT+CIPSNTPCFG=1,\" + timezone + \",\\\"\" + NTP_SERVER_URL + \"\\\"\", \"OK\", 500) == false) return\n\n        internetTimeInitialized = true\n        return\n    }\n\n\n\n    /**\n     * Return true if the internet time is updated successfully.\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=21\n    //% blockGap=8\n    //% blockId=esp8266_is_internet_time_updated\n    //% block=\"internet time updated\"\n    export function isInternetTimeUpdated(): boolean {\n        return internetTimeUpdated\n    }\n\n\n\n    /**\n     * Update the internet time.\n     * @param timezone Timezone. eg: 8\n     */\n    //% subcategory=\"Internet Time\"\n    //% weight=20\n    //% blockGap=8\n    //% blockId=esp8266_update_internet_time\n    //% block=\"update internet time\"\n    export function updateInternetTime() {\n        // Reset the flag.\n        internetTimeUpdated = false\n\n        // Make sure the WiFi is connected.\n        if (isWifiConnected() == false) return\n\n        // Make sure it's initialized.\n        if (internetTimeInitialized == false) return\n\n        // Wait until we get a valid time update.\n        let responseArray\n        let timestamp = input.runningTime()\n        while (true) {\n            // Timeout after 10 seconds.\n            if (input.runningTime() - timestamp > 20000) {\n                return\n            }\n\n            // Get the time.\n            sendCommand(\"AT+CIPSNTPTIME?\")\n            let response = getResponse(\"+CIPSNTPTIME:\", 2000)\n            if (response == \"\") return\n\n            // Fill up the time and date accordingly.\n            response = response.slice(response.indexOf(\":\") + 1)\n            responseArray = response.split(\" \")\n\n            // Remove the preceeding \" \" for each field.\n            while (responseArray.removeElement(\"\"));\n\n            // If the year is still 1970, means it's not updated yet.\n            if (responseArray[4] != \"1970\") {\n                break\n            }\n\n            basic.pause(100)\n        }\n\n        // Day of week.\n        switch (responseArray[0]) {\n            case \"Mon\": weekday = 1; break\n            case \"Tue\": weekday = 2; break\n            case \"Wed\": weekday = 3; break\n            case \"Thu\": weekday = 4; break\n            case \"Fri\": weekday = 5; break\n            case \"Sat\": weekday = 6; break\n            case \"Sun\": weekday = 7; break\n        }\n\n        // Month.\n        switch (responseArray[1]) {\n            case \"Jan\": month = 1; break\n            case \"Feb\": month = 2; break\n            case \"Mar\": month = 3; break\n            case \"Apr\": month = 4; break\n            case \"May\": month = 5; break\n            case \"Jun\": month = 6; break\n            case \"Jul\": month = 7; break\n            case \"Aug\": month = 8; break\n            case \"Sep\": month = 9; break\n            case \"Oct\": month = 10; break\n            case \"Nov\": month = 11; break\n            case \"Dec\": month = 12; break\n        }\n\n        // Day.\n        day = parseInt(responseArray[2])\n\n        // Time.\n        let timeArray = responseArray[3].split(\":\")\n        hour = parseInt(timeArray[0])\n        minute = parseInt(timeArray[1])\n        second = parseInt(timeArray[2])\n\n        // Year.\n        year = parseInt(responseArray[4])\n\n\n\n        // Wait until OK is received.\n        if (getResponse(\"OK\") == \"\") return\n\n\n        internetTimeUpdated = true\n        return\n    }\n}\n","pxt.json":"{\n    \"name\": \"wifi ip\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"Grove\": \"github:seeed-studio/pxt-grove#v0.7.5\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"wifi.ts\",\n        \"tempsinternet.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}}],"shares":[],"lastSaveTime":1764366685893}